<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é»‘ç™½è—æ§åˆ¶æ¿ + å›ºå®šè¨ˆæ­¥å™¨</title>
    <link rel="icon" type="image/png" href="../0-IMAGE/0_Nav/logo-éŠæˆ²å»³.png?v=1"> <!-- ç¶²ç«™åœ–æ¨™è¨­å®š -->
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
    <style>
        /* ===== CSS é»‘è—ç§‘æŠ€é¢¨ ===== */
        body {
            font-family: "Courier New", monospace;
            background: #000 url('../0-IMAGE/1_Guide-page/æ˜Ÿç©ºèƒŒæ™¯.gif') center/auto no-repeat fixed;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }

        /* ==================== å°è¦½åˆ— ====================== */
        #header-container {
            position: fixed;
            /* å›ºå®šåœ¨è¢å¹•é ‚ç«¯ */
            top: 0;
            left: 0;
            width: 100%;
            height: 60px;
            /* å°è¦½åˆ—é«˜åº¦ */
            background-color: #333;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            font-size: 20px;
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.4);
            /* æ‡¸æµ®æ„Ÿé™°å½± */
        }

        /* =================== è¿”å›ä¸Šä¸€é  ===================== */
        /* å·¦ä¸Šè§’è¿”å›æŒ‰éˆ• */
        .back-btn {
            position: fixed;
            top: 150px;
            left: 20px;
            z-index: 2000;
            background: rgba(0, 0, 0, 0.6);
            color: #fff;
            border: 2px solid white;
            padding: 12px 18px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(250, 247, 247, 0.978);
            transition: all 0.2s ease;
        }

        .back-btn:hover {
            background: rgba(0, 0, 0, 0.8);
            transform: scale(1.05);
        }

        #stepCounterContainer {
            position: fixed;
            left: 20px;
            top: 40px;
            background: #111;
            color: #0af;
            padding: 10px 15px;
            border: 2px solid #0af;
            border-radius: 8px;
            box-shadow: 0 0 15px #0af, inset 0 0 25px #0af5;
            font-weight: bold;
            font-size: 1em;
            z-index: 1000;
        }

        .control-panel {
            width: 1000px;
            max-width: 95%;
            height: 600px;
            margin-top: 80px;
            background: #111;
            border: 2px solid #0af;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: 0 0 20px #0af, 0 0 40px #0af5 inset;
        }

        .panel-header {
            padding: 15px;
            background: #000;
            border-bottom: 2px solid #0af;
            font-weight: bold;
            font-size: 1.2em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-light {
            width: 12px;
            height: 12px;
            margin-left: 10px;
            border-radius: 50%;
            background: #0af;
            box-shadow: 0 0 8px #0af;
            animation: blink 1s infinite;
        }

        @keyframes blink {

            0%,
            50%,
            100% {
                opacity: 1;
            }

            25%,
            75% {
                opacity: 0.2;
            }
        }

        .panel-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
            background: #111;
        }

        .message {
            padding: 10px 15px;
            border-radius: 5px;
            font-size: 0.95em;
            box-shadow: 0 0 5px #0af;
            border-left: 3px solid #0af;
        }

        .user-message {
            align-self: flex-end;
            background: #001122;
        }

        .bot-message {
            align-self: flex-start;
            background: #111;
        }

        .option-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .option-buttons button {
            display: none;
            padding: 12px 20px;
            border-radius: 25px;
            border: 2px solid #0af;
            background: linear-gradient(145deg, #001122, #003366);
            color: #0af;
            font-weight: bold;
            font-size: 1em;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 170, 255, 0.4), inset 0 0 5px rgba(0, 170, 255, 0.2);
            transition: all 0.2s ease;
        }

        .option-buttons button:hover {
            background: linear-gradient(145deg, #003366, #0066cc);
            box-shadow: 0 6px 20px rgba(0, 170, 255, 0.7), inset 0 0 10px rgba(0, 170, 255, 0.4);
            transform: translateY(-2px);
            color: #fff;
        }

        .option-buttons button:active {
            box-shadow: 0 2px 8px rgba(0, 170, 255, 0.5), inset 0 0 15px rgba(0, 255, 255, 0.6);
            transform: translateY(1px);
        }

        .panel-input {
            display: flex;
            padding: 10px;
            border-top: 2px solid #0af;
            background: #000;
        }

        .panel-input input {
            flex: 1;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #0af;
            background: #111;
            color: #fff;
            outline: none;
            font-family: monospace;
        }

        .panel-input button {
            margin-left: 10px;
            padding: 10px 20px;
            border-radius: 5px;
            border: 1px solid #0af;
            background: #000;
            color: #0af;
            cursor: pointer;
            font-weight: bold;
        }

        .panel-input button:hover {
            background: #0af;
            color: #000;
            transition: 0.2s;
        }

        #announcementOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            /* ç¢ºä¿åœ¨æ§åˆ¶æ¿ä¹‹ä¸Š */
        }

        #announcementBox {
            background: #111;
            border: 2px solid #0af;
            border-radius: 15px;
            padding: 30px 40px;
            text-align: center;
            box-shadow: 0 0 25px #0af, 0 0 50px #0af inset;
            max-width: 500px;
        }

        #announcementBox img#mascot {
            width: 100px;
            margin-bottom: 15px;
        }

        #announcementBox p#announcementText {
            color: #0af;
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 20px;
        }

        #announcementBox button#announcementContinueBtn {
            padding: 10px 25px;
            border-radius: 25px;
            border: 2px solid #0af;
            background: linear-gradient(145deg, #001122, #003366);
            color: #0af;
            font-weight: bold;
            cursor: pointer;
        }

        #announcementBox button#announcementContinueBtn:hover {
            background: linear-gradient(145deg, #003366, #0066cc);
            color: #fff;
        }


        /* ==================== å‰ç¥¥ç‰© ====================== */
        #Mrs_XL-2-container {
            position: fixed;
            /* å›ºå®šåœ¨è¢å¹•é ‚ç«¯ */
            z-index: 50000;
            font-size: 20px;
            box-shadow: 0 3px 12px rgba(255, 255, 255, 0.4);
            /* æ‡¸æµ®æ„Ÿé™°å½± */
        }

        /* ====== å½ˆå‡ºè¦–çª—å…§å®¹ ====== */
        /* è¦–çª—é è¨­éš±è— */
        /* å½ˆçª—æ·¡å…¥æ·¡å‡º */
        .ai-popup-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50%;
            height: 90%;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            z-index: 6000;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);

            /* å‹•ç•«æ•ˆæœ */
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.8);
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .ai-popup-content.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .ai-popup-content iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 10px;
        }

        #close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: #ff4d4d;
            border: none;
            color: white;
            font-size: 18px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
        }

        /* ====== AIå‰ç¥¥ç‰©- å½ˆå‡ºè¦–çª— ====== */
        /* é®ç½©æ·¡å…¥æ·¡å‡º */
        #ai-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 5000;

            /* å‹•ç•«æ•ˆæœ */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease;
        }

        #ai-popup.show {
            opacity: 1;
            visibility: visible;
        }
    </style>
</head>

<body>
    <!-- å°è¦½åˆ— -->
    <header>
        <div id="header-container"></div>
        <button class="back-btn" onclick="enterBack()">è¿”å›</button>
    </header>

    <!-- å›ºå®šå…ƒç´ -å‰ç¥¥ç‰© + å°è©±æ¡† -->
    <div id="Mrs_XL-2-container"></div>
    <!-- åµŒå…¥colabAI -->
    <div id="ai-popup">
        <!-- âœ… éš±è—çš„å½ˆå‡ºè¦–çª—(AIå°è©±) -->
        <div class="ai-popup-content" id="aiPopup">
            <iframe src="0.11_colabAI.html" frameborder="0"></iframe>
            <button id="close-btn">âœ•</button>
        </div>
    </div>

    <div id="stepCounterContainer" style="margin-top: 50px;">ç•¶å‰ç‹€æ…‹: <span id="stepCounter">0</span></div>

    <div class="control-panel">
        <div class="panel-header">
            <span>æƒ…å¢ƒæ¨¡æ“¬é¡Œ</span>
            <span class="status-light"></span>
            <span id="chapterTitle">ç¬¬ä¸€ç«  ç³»çµ±å®‰å…¨æ˜¯ä»€éº¼ï¼Ÿ</span>
        </div>

        <div class="panel-messages" id="panelMessages"></div>

        <div class="option-buttons">
            <button>A.</button><button>B.</button>
            <button>C.</button><button>D.</button>
            <button>E.</button>
        </div>

        <button id="continueBtn">ç¹¼çºŒ</button>

        <div class="panel-input">
            <input type="text" id="userInput" placeholder="è¼¸å…¥æŒ‡ä»¤..." />
            <button onclick="sendMessage()">é€å‡º</button>
        </div>
    </div>

    <!-- å…¬å‘Šæ¡† HTML -->
    <div id="announcementOverlay" style="display:none;">
        <div id="announcementBox">
            <img src="../0-IMAGE/hi.png" alt="å‰ç¥¥ç‰©" id="mascot">
            <p id="announcementText">ğŸ“¢ ç³»çµ±å…¬å‘Š</p>
            <button id="announcementContinueBtn">ç¹¼çºŒ</button>
        </div>
    </div>


    <script>
        //è¼‰å…¥å°è¦½åˆ—
        fetch('./0_Nav-2.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-container').innerHTML = data;
            })
            .catch(error => {
                console.error('è¼‰å…¥ HTML å¤±æ•—:', error);
            });
    </script>

    <!-- ğŸ¤– è¼‰å…¥å‰ç¥¥ç‰© & AI åŠ©æ‰‹å½ˆçª— -->
    <script>
        /* ------------------------
        åŠŸèƒ½ï¼šè¼‰å…¥å‰ç¥¥ç‰© HTMLï¼ˆå«äº’å‹•èˆ‡AIåŠ©æ‰‹é–‹å•Ÿï¼‰
        èªªæ˜ï¼š
        1ï¸âƒ£ fetch è¼‰å…¥å‰ç¥¥ç‰©æª”æ¡ˆã€Œ0.1_Mrs_XL-2.htmlã€
        2ï¸âƒ£ é‡æ–°åŸ·è¡Œå…§åµŒ script
        3ï¸âƒ£ ç¶å®šé»æ“Šå‰ç¥¥ç‰© â†’ é–‹å•Ÿ AI åŠ©æ‰‹å½ˆçª—
        ------------------------ */
        fetch('./0.1_Mrs_XL-2.html')
            .then(res => res.text())
            .then(html => {
                const container = document.getElementById('Mrs_XL-2-container');
                container.innerHTML = html;

                // é‡æ–°åŸ·è¡Œå‰ç¥¥ç‰©å…§åµŒ script
                const scripts = container.querySelectorAll('script');
                scripts.forEach(oldScript => {
                    const newScript = document.createElement('script');
                    if (oldScript.src) newScript.src = oldScript.src;
                    else newScript.textContent = oldScript.textContent;
                    document.body.appendChild(newScript);
                });

                // ç¶å®šå‰ç¥¥ç‰© â†’ é–‹å•Ÿ/é—œé–‰ AI åŠ©æ‰‹è¦–çª—
                const mascot = document.getElementById("Mrs_XL-2-container");
                const aiPopupContainer = document.getElementById("ai-popup");
                const aiPopupContent = document.getElementById("aiPopup");
                const closeBtn = document.getElementById("close-btn");

                if (mascot && aiPopupContainer && aiPopupContent && closeBtn) {
                    mascot.addEventListener("click", () => {
                        aiPopupContainer.classList.add("show");
                        aiPopupContent.classList.add("show");
                    });

                    function closePopup() {
                        aiPopupContent.classList.remove("show");
                        aiPopupContainer.classList.remove("show");
                    }

                    closeBtn.addEventListener("click", closePopup);

                    // é»æ“Šé®ç½©é—œé–‰
                    aiPopupContainer.addEventListener("click", e => {
                        if (e.target === e.currentTarget) closePopup();
                    });
                }
            });
    </script>

    <script>
        const panelMessages = document.getElementById('panelMessages');
        const userInput = document.getElementById('userInput');
        const stepCounterEl = document.getElementById('stepCounter');
        const continueBtn = document.getElementById('continueBtn');
        const optionButtons = document.querySelectorAll('.option-buttons button');

        let excelData = null;
        let stepCounter = 0;
        let firstClick = true;
        let PlayerChoose = '';
        let Choose = '';
        let Choosebtncol = '';
        let ArrayList1 = [];
        const excelPath = "../4-Teaching/3.ch_story.xlsx";


        // å–å¾—ç¶²å€åƒæ•¸-å…¨åŸŸï¼‰
        const params = Object.fromEntries(new URLSearchParams(location.search));
        const { title, subtitle } = params;


        // ===== è®€å– Excel =====
        // ===== è®€å– Excel ä¸¦æ ¹æ“šç¶²å€åƒæ•¸ç¯©é¸ç« ç¯€ =====
        fetch(excelPath)
            .then(res => res.arrayBuffer())
            .then(data => {
                const wb = XLSX.read(data, { type: 'array' });
                const sheet = wb.Sheets[wb.SheetNames[0]];
                let allData = XLSX.utils.sheet_to_json(sheet, { header: 1 });

                // ç¯©é¸å‡ºç›¸åŒç« ç¯€çš„è³‡æ–™ï¼ˆAæ¬„å«ç« ç¯€æ¨™é¡Œï¼‰
                if (title && subtitle) {
                    const chapterKey = `${title.trim()}`;
                    const filtered = allData.filter(row => String(row[0] || '').trim() === chapterKey);
                    if (filtered.length > 0) {
                        excelData = filtered;
                        appendMessageTyping(`[ç³»çµ±]å·²è¼‰å…¥ç« ç¯€ï¼šã€Œ${chapterKey}ã€ï¼Œå…± ${excelData.length} ç­†è³‡æ–™ã€‚`, 'bot');
                    } else {
                        excelData = [];
                        appendMessageTyping(`[ç³»çµ±]æœªæ‰¾åˆ°ç« ç¯€ã€Œ${chapterKey}ã€ï¼Œè«‹ç¢ºèª Excel å…§å®¹ã€‚`, 'bot');
                    }
                } else {
                    excelData = allData;
                    appendMessageTyping(`[ç³»çµ±]æœªæŒ‡å®šç« ç¯€ï¼Œå·²è¼‰å…¥å…¨éƒ¨ ${excelData.length} ç­†è³‡æ–™ã€‚`, 'bot');
                }
            })
            .catch(() => appendMessageTyping('[ç³»çµ±]è®€å– Excel å¤±æ•—ï¼Œè«‹ç¢ºèªè·¯å¾‘æ­£ç¢º', 'bot'));

        // ===== è¨Šæ¯é¡¯ç¤º =====
        function appendMessageTyping(text, sender = 'bot', callback = null) {
            const msg = document.createElement('div');
            msg.classList.add('message', sender === 'user' ? 'user-message' : 'bot-message');
            panelMessages.appendChild(msg);
            let i = 0;
            const interval = setInterval(() => {
                msg.innerText += text.charAt(i++);
                panelMessages.scrollTop = panelMessages.scrollHeight;
                if (i >= text.length) {
                    clearInterval(interval);
                    if (callback) callback(); // è¨Šæ¯æ‰“å®Œå¾Œå‘¼å« callback
                }
            }, 30);
        }

        function appendMessage(text, sender = 'bot') {
            const msg = document.createElement('div');
            msg.classList.add('message', sender === 'user' ? 'user-message' : 'bot-message');
            msg.innerText = text;
            panelMessages.appendChild(msg);
            panelMessages.scrollTop = panelMessages.scrollHeight;
        }

        // ===== å‚³é€è¨Šæ¯ =====
        function sendMessage() {
            const msg = userInput.value.trim();
            if (!msg) return;
            appendMessage(msg, 'user');

            // ç´€éŒ„ç©å®¶é¸æ“‡
            optionButtons.forEach((btn, idx) => {
                if (btn.style.display !== 'none' && btn.innerText === msg) {
                    PlayerChoose = msg;
                    Choose = `æ¬„ä½ ${String.fromCharCode(70 + idx)} (æŒ‰éˆ• ${msg})`;
                    console.log("ç©å®¶é»é¸æ¬„ä½:", Choose);
                }
            });

            userInput.value = '';
            continueBtn.click();
        }

        userInput.addEventListener('keydown', e => { if (e.key === 'Enter') sendMessage(); });

        // ===== é»æ“Šç¹¼çºŒ =====
        continueBtn.addEventListener('click', () => {
            stepCounter++;
            stepCounterEl.innerText = stepCounter;

            // è®€å–ç•¶åˆ— A~K è³‡æ–™ï¼Œå­˜å…¥ ArrayList1
            if (excelData) {
                const currentRow = excelData.find(row => String(row[1]).trim() === String(stepCounter).trim());
                if (currentRow) {
                    ArrayList1 = currentRow.slice(0, 11); // A~K
                    console.log("ç•¶åˆ—è³‡æ–™ ArrayList1:", ArrayList1);
                }
            }

            checkExcelForStep(stepCounter);
            if (firstClick) firstClick = false;
        });

        let reviewCount = 0; // æ–°å¢ï¼šè¨˜éŒ„èŠ¯æ¨‚é»è©•æ¬¡æ•¸
        // ===== æª¢æŸ¥ Excel å°æ‡‰æ­¥é©Ÿ =====
        function checkExcelForStep(stepValue) {
            if (!excelData) return;
            const targetRow = excelData.find(row => String(row[1]).trim() === String(stepValue).trim());
            if (!targetRow) return;

            const typeC = targetRow[2];
            const [D_Col, F_Col, G_Col, H_Col, I_Col, J_Col] = [3, 5, 6, 7, 8, 9];
            const optionsArray = [F_Col, G_Col, H_Col, I_Col, J_Col].map(col => targetRow[col] || '');

            optionButtons.forEach(btn => { btn.style.display = 'none'; btn.innerText = ''; });
            continueBtn.style.display = optionsArray.some(opt => opt.trim() !== '') ? 'none' : 'inline-block';

            switch (typeC) {

                case 'é¸æ“‡':
                    appendMessageTyping(targetRow[D_Col] || 'ï¼ˆæƒ…å¢ƒæ•˜è¿°ï¼‰', 'bot');
                    optionsArray.forEach((opt, idx) => {
                        if (opt.trim() !== '') {
                            optionButtons[idx].style.display = 'inline-block';
                            optionButtons[idx].innerText = opt;
                            optionButtons[idx].onclick = () => {
                                PlayerChoose = opt.trim();
                                Choosebtn = `${String.fromCharCode(70 + idx)}`;
                                Choose = `æ¬„ä½ ${String.fromCharCode(70 + idx)} (æŒ‰éˆ• ${opt})`;
                                console.log("ç©å®¶é»é¸æ¬„ä½:", Choose);

                                // ===== ç‰¹æ®Šé‚è¼¯ =====
                                if (stepCounter === 1 && typeC === 'é¸æ“‡') {
                                    if (Choosebtn === 'F') { // A
                                        appendMessageTyping("[ç³»çµ±]æº–å‚™ä¸­......................................................", 'bot', () => {
                                            stepCounter++; // é€²å…¥ä¸‹ä¸€æ­¥
                                            stepCounterEl.innerText = stepCounter;
                                            checkExcelForStep(stepCounter); // è®€å–ä¸‹ä¸€æ­¥
                                        });
                                        appendMessageTyping("")
                                        return;
                                    } else if (Choosebtn === 'G') { // B
                                        appendMessageTyping("", 'bot', () => {
                                            stepCounter = 1; // é‡æ–°è¼‰å…¥
                                            stepCounterEl.innerText = stepCounter;
                                            checkExcelForStep(stepCounter); // é‡æ–°è®€å–ç¬¬1åˆ—
                                        });
                                        return;
                                    }
                                }

                                userInput.value = opt.trim();
                                sendMessage();
                            };
                        }
                    });
                    break;
                case 'æ•˜è¿°':
                    appendMessageTyping(targetRow[D_Col] || 'ï¼ˆæƒ…å¢ƒæ•˜è¿°ï¼‰', 'bot');
                    break;

                case 'çµæœ':
                    continueBtn.style.display = 'none'; // éš±è—ç¹¼çºŒæŒ‰éˆ•ï¼Œç­‰çµæœé¡¯ç¤ºå¾Œå†å‡ºç¾
                    if (Choosebtn === "F") { //A
                        appendMessageTyping('[çµæœ]' + targetRow[F_Col]);
                        Choosebtncol = F_Col;
                    } else if (Choosebtn === "G") { //B
                        appendMessageTyping('[çµæœ]' + targetRow[G_Col]);
                        Choosebtncol = G_Col;
                    } else if (Choosebtn === "H") {  //C
                        appendMessageTyping('[çµæœ]' + targetRow[H_Col]);
                        Choosebtncol = H_Col;
                    } else if (Choosebtn === "I") {  //D
                        appendMessageTyping('[çµæœ]' + targetRow[I_Col]);
                        Choosebtncol = I_Col;
                    } else if (Choosebtn === "J") {  //E
                        appendMessageTyping('[çµæœ]' + targetRow[J_Col]);
                        Choosebtncol = J_Col;
                    }
                    continueBtn.style.display = 'inline-block';


                    break;
                case 'èŠ¯æ¨‚é»è©•':
                    // é¡¯ç¤ºå…¬å‘Šæ¡†
                    reviewCount++;
                    // é¡¯ç¤ºå…¬å‘Šæ¡†
                    announcementOverlay.style.display = 'flex';
                    document.getElementById('announcementText').innerText = targetRow[Choosebtncol] || 'ï¼ˆèŠ¯æ¨‚é»è©•ï¼‰';

                    const box = document.getElementById('announcementBox');
                    const btnArea = document.createElement('div');
                    btnArea.style.marginTop = "20px";
                    btnArea.style.display = "flex";
                    btnArea.style.justifyContent = "center";
                    btnArea.style.gap = "15px";

                    // æ¸…ç©ºèˆŠæŒ‰éˆ•
                    box.querySelectorAll('button').forEach(btn => btn.remove());

                    if (reviewCount === 2) {
                        // ç¬¬äºŒæ¬¡å‡ºç¾ -> å…©é¡†æŒ‰éˆ•
                        const params = Object.fromEntries(new URLSearchParams(location.search));
                        const { title, subtitle, playerName, playerGrade } = params;
                        const page = '7_ToStory'; // ä¾å¯¦éš›é é¢å‘½åä¿®æ”¹

                        const backToListBtn = document.createElement('button');
                        backToListBtn.innerText = 'è¿”å›æƒ…å¢ƒæ¸¬é©—åˆ—è¡¨';
                        backToListBtn.onclick = () => {
                            window.location.href = `${page}.html?title=${encodeURIComponent(title)}&subtitle=${encodeURIComponent(subtitle)}&playerName=${encodeURIComponent(playerName)}&playerGrade=${encodeURIComponent(playerGrade)}`;
                        };

                        const goBackBtn = document.createElement('button');
                        goBackBtn.innerText = 'è¿”å›ä¸Šä¸€é ';
                        goBackBtn.onclick = () => history.back();

                        [backToListBtn, goBackBtn].forEach(btn => {
                            btn.style.padding = "10px 25px";
                            btn.style.borderRadius = "25px";
                            btn.style.border = "2px solid #0af";
                            btn.style.background = "linear-gradient(145deg, #001122, #003366)";
                            btn.style.color = "#0af";
                            btn.style.fontWeight = "bold";
                            btn.style.cursor = "pointer";
                            btn.onmouseenter = () => { btn.style.background = "linear-gradient(145deg, #003366, #0066cc)"; btn.style.color = "#fff"; };
                            btn.onmouseleave = () => { btn.style.background = "linear-gradient(145deg, #001122, #003366)"; btn.style.color = "#0af"; };
                            btnArea.appendChild(btn);
                        });

                        box.appendChild(btnArea);
                    } else {
                        // ç¬¬ä¸€æ¬¡ -> å–®é¡†ç¹¼çºŒæŒ‰éˆ•
                        const continueBtnNew = document.createElement('button');
                        continueBtnNew.id = 'announcementContinueBtn';
                        continueBtnNew.innerText = 'ç¹¼çºŒ';
                        continueBtnNew.onclick = () => {
                            announcementOverlay.style.display = 'none';
                            continueBtn.click();
                        };
                        box.appendChild(continueBtnNew);
                    }
                    break;

                default:
                    appendMessageTyping(`#æœªçŸ¥é¡å‹ï¼š${typeC}`, 'bot');
            }
        }


        // ===== URL ç« ç¯€æ¨™é¡Œ =====
        window.addEventListener('DOMContentLoaded', () => {
            const params = Object.fromEntries(new URLSearchParams(location.search));
            const chapterSpan = document.getElementById('chapterTitle');
            if (chapterSpan && params.title && params.subtitle)
                chapterSpan.innerText = `${params.title} ${params.subtitle}`;
        });
    </script>

    <script>
        const announcementOverlay = document.getElementById('announcementOverlay');
        const announcementContinueBtn = document.getElementById('announcementContinueBtn');

        // é»æ“Šå…¬å‘Šæ¡†çš„ã€Œç¹¼çºŒã€ç­‰åŒé»æ“ŠåŸæœ¬çš„ continueBtn
        announcementContinueBtn.addEventListener('click', () => {
            announcementOverlay.style.display = 'none'; // é—œé–‰å…¬å‘Šæ¡†
            continueBtn.click(); // è§¸ç™¼åŸæœ¬ç¹¼çºŒæŒ‰éˆ•
        });

    </script>

    <script>
        // â–¶è¿”å›æŒ‰éˆ•ï¼š ï¼ˆä¿ç•™åŸå…ˆåƒæ•¸ï¼‰
        function enterBack() {
            const referrer = document.referrer; // å–å¾—ä¸Šä¸€é å®Œæ•´ç¶²å€
            console.log("ä¸Šä¸€é :", referrer);

            // é è¨­åƒæ•¸ï¼Œå¦‚æœä½ éœ€è¦å¸¶åƒæ•¸å›å»
            const urlParams = new URLSearchParams(window.location.search);
            const title = urlParams.get("title") || "";
            const subtitle = urlParams.get("subtitle") || "";
            const encodedTitle = encodeURIComponent(title);
            const encodedSubtitle = encodeURIComponent(subtitle);

            if (referrer && referrer.includes("4-Game-Chapter.html")) {
                window.location.href = `4-Game-Chapter.html?title=${encodedTitle}&subtitle=${encodedSubtitle}`;
            } else {
                window.location.href = "7_ToStory.html";
            }
        }
    </script>

</body>


</html>

