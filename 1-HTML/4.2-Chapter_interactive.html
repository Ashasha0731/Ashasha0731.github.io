<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç« ç¯€æ¸¬é©—</title>
    <link rel="icon" type="image/png" href="../0-IMAGE/0_Nav/logo-éŠæˆ²å»³.png">    <!-- ç¶²ç«™åœ–æ¨™è¨­å®š -->
    <script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>  <!-- å…ˆåœ¨ <head> åŠ å…¥ SheetJS -->
    <style>
/* ==================== å…¨åŸŸæ¨£å¼ ==================== */
        body{
            font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
            background: #0a0a0a;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            background-image: url('../0-IMAGE/1_Guide-page/æ˜Ÿç©ºèƒŒæ™¯.gif');
            background-size: cover;       /* è¦†è“‹æ•´å€‹å®¹å™¨ */
            background-repeat: repeat; /* é‡è¤‡æ–¹ä¾¿æ»¾å‹• */
            animation: move-bg 60s linear infinite;
        }

        @keyframes move-bg {
            0% { background-position: 0 0; }
            100% { background-position: -5000px 0; } /* å¾€å·¦ç§»å‹• */
        }

/* ==================== å°è¦½åˆ— ====================== */
        #header-container {
            position: fixed; /* å›ºå®šåœ¨è¢å¹•é ‚ç«¯ */
            top: 0;
            left: 0;
            width: 100%;
            height: 60px; /* å°è¦½åˆ—é«˜åº¦ */
            background-color: #333;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            font-size: 20px;
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.4);/* æ‡¸æµ®æ„Ÿé™°å½± */
        }

/* =================== è¿”å›ä¸Šä¸€é  ===================== */
        /* å·¦ä¸Šè§’è¿”å›æŒ‰éˆ• */
        .back-btn {
            position: fixed;
            top: 95px;
            left: 20px;
            z-index: 2000;
            background: rgba(0,0,0,0.6);
            color: #fff;
            border: 2px solid white;
            padding: 12px 18px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 12px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(250, 247, 247, 0.978);
            transition: all 0.2s ease;
        }

        .back-btn:hover {
            background: rgba(0,0,0,0.8);
            transform: scale(1.05);
        }


/* ==================== å½ˆçª—æ¨£å¼ =========== */
        .player-popup {
            position: fixed;
            top: 0; left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0,0,0,0.7);
            display: none; /* é è¨­éš±è— */
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.4s ease;
        }

        .popup-content {
            background: rgba(255,255,255,0.95);
            padding: 30px 40px;
            border-radius: 16px;
            text-align: center;
            width: 350px;
            box-shadow: 0 0 20px rgba(255,255,255,0.5);
        }

        .popup-content h2 {
            margin-top: 0;
            color: #222;
        }
        .popup-content p {
            margin-top: 0;
            color: #222;
        }

        .popup-content input,
        .popup-content select {
            width: 90%;
            margin: 10px 0;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #aaa;
            font-size: 16px;
        }

        #playerGrade {
            max-height: 120px;  /* é™åˆ¶å±•é–‹æ¸…å–®çš„é«˜åº¦ */
            overflow-y: auto;   /* è¶…å‡ºç¯„åœå‡ºç¾æ»¾å‹•æ¢ */
        }

        .popup-content button {
            background: linear-gradient(90deg, #393ccc, #5356ea);
            color: white;
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            font-size: 18px;
            cursor: pointer;
            transition: 0.3s;
        }

        .popup-content button:hover {
            transform: scale(1.05);
            background: linear-gradient(90deg, #4e54f9, #13d366);
        }

/* =================== ç« ç¯€æ¨™é¡Œ ===================== */
        .chapter-img1{
            width: 250px;           /* è®“åœ–ç‰‡æ¯”è¢å¹•å¤§ */
            height: 40px;
            position: fixed;
            left: 0px;
            top: 100px;
            z-index: 101;
            filter: drop-shadow(0px 0px 5px #ffffff);     /*å¢åŠ ç¬¦åˆPNGçš„é™°å½±*/
            transition: transform 0.3s ease; /* å¹³æ»‘éæ¸¡ */
        }

        .chapter-title1 {    /*ç« ç¯€*/
            font-size: 30px;
            position: fixed;
            top: 100px;
            left: 110px;
            z-index: 102;
            color: rgb(255, 255, 255);
            text-shadow: 
                0 0 5px #fff,
                0 0 20px rgb(0, 0, 0);
            font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
            display: block;          /* ç¢ºä¿å¯è¢«ç½®ä¸­ */
            width: 100%;             /* å¯é¸ï¼Œä¿è­‰å æ»¿æ©«å‘ç½®ä¸­ */
        }

        .chapter-img2-wrapper {
            position: relative;       /* å»ºç«‹å®šä½å®¹å™¨ï¼Œè®“æ–‡å­—æµ®åœ¨åœ–ç‰‡ä¸Š */
            width: 600px;             /* å®¹å™¨å¯¬åº¦ï¼Œç­‰æ–¼åœ–ç‰‡å¯¬åº¦ */
            height: 80px;             /* å®¹å™¨é«˜åº¦ï¼Œç­‰æ–¼åœ–ç‰‡é«˜åº¦ */
            margin: 20px auto;        /* æ°´å¹³ç½®ä¸­ï¼Œå‚ç›´é–“è· 20px */
        }

        .chapter-img2 {
            width: 600px;              /* å……æ»¿å®¹å™¨ */
            height: 100px;
            display: block;           /* å€å¡Šå…ƒç´  */
            filter: drop-shadow(0px 0px 10px #ffffffae);
        }

        .chapter-title2 {
            position: absolute;       /* æ–‡å­—æµ®åœ¨åœ–ç‰‡ä¸Š */
            top: 50%;                 /* å‚ç›´ç½®ä¸­ */
            left: 50%;  
            margin-top: 8px;              /* æ°´å¹³ç½®ä¸­ */
            transform: translate(-50%, -50%); /* çœŸæ­£ç½®ä¸­ */
            color: #fff;
            font-size: 40px;
            text-shadow: 
                0 0 5px #fff,
                0 0 10px #000,
                0 0 20px #000;
            text-align: center;
            white-space: nowrap;      /* ä¸æ›è¡Œ */
        }

/* ==================== æ¸¬é©— ====================== */
        .quiz-container {
            max-width: 1000px;
            width: 1000px;
            background: #111;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 0 20px rgba(255,255,255,0.2);
        }

        .question { margin-bottom: 20px;margin-left: 60px; }
        .options {
            display: flex;
            gap: 20px; /* é¸é …é–“è· */
        }
        .options label {
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        .inp input[type="radio"] { margin-right: 10px; }
        button {
            padding: 10px 20px;
            border-radius: 12px;
            border: none;
            background: #1a73e8;
            color: #fff;
            font-size: 16px;
            cursor: pointer;
        }
        button:hover { background: #1664c1; }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top:0; left:0; right:0; bottom:0;
            background: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: #222;
            padding: 20px 30px;
            border-radius: 15px;
            text-align: center;
        }
        .modal-content button { margin-top: 15px; }

        /* å•ç­”é¡Œåˆå§‹éš±è— */
        #open-answer-container { display: none; margin-top: 20px; }


/* ===================== ç« ç¯€æŒ‰éˆ• =================== */
        .img-GOsimulation{
            width: 400px;          
            height: auto;
            position: fixed;
            right: -1px;
            bottom: 20px;
            z-index: 5000;
            filter: drop-shadow(0px 0px 10px #ffffffae);     /*å¢åŠ ç¬¦åˆPNGçš„é™°å½±*/
            transition: transform 0.3s ease; /* å¹³æ»‘éæ¸¡ */
        }

        .img-GoChapter{
            width: 250px;           /* è®“åœ–ç‰‡æ¯”è¢å¹•å¤§ */
            height: auto;
            position: fixed;
            right: 10px;
            bottom: 100px;
            z-index: 5001;
            filter: drop-shadow(0px 0px 10px #ffffffae);     /*å¢åŠ ç¬¦åˆPNGçš„é™°å½±*/
            transition: transform 0.3s ease; /* å¹³æ»‘éæ¸¡ */
        }


/* ===================== åº•åˆ— =================== */
        .footer {
            width: 100%;
            height: 50px; /* é«˜ä¸€é»æ›´èˆ’é© */
            position: fixed;
            bottom: 0;
            left: 0;
            z-index: 1000;

            /* æ¼¸å±¤ + åŠé€æ˜ + æ¯›ç»ç’ƒ */
            background: linear-gradient(120deg, rgba(9,9,9,0.4), rgba(39,40,46,0.6), rgba(15,15,15,0.8));
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-top: 1px solid rgba(255,255,255,0.2); /* é ‚éƒ¨ç´°é‚Šæ¡†å¢åŠ å±¤æ¬¡ */

            /* æ–‡å­—æ¨£å¼ */
            color: #ffffff;
            font-size: 14px;
            font-weight: 500;
            letter-spacing: 1px;
            text-shadow: 0 0 5px rgba(0,0,0,0.7);

            /* ç½®ä¸­ */
            display: flex;
            justify-content: center;
            align-items: center;

            /* å‹•æ…‹å…‰æšˆï¼ˆå¯é¸ï¼‰ */
            box-shadow: 0 0 15px rgba(255,255,255,0.2) inset;
        }

    </style>
</head>

<!--------------------------- html ----------------------------->
<body>
    <!-- å°è¦½åˆ— -->
    <header>
        <div id="header-container"></div>
        <button class="back-btn" onclick="enterBack()">è¿”å›</button>
        <!-- ç« ç¯€æ¨™é¡Œ -->
        <div>
            <img class="chapter-img1" src="../0-IMAGE/4-Game-Chapter/ç« ç¯€æ——å¹Ÿ1.png" alt="ç« ç¯€æ——å¹Ÿ">
            <span class="chapter-title1">ç¬¬ä¸€ç«   â€‹  â€‹  â€‹ </span>
        </div>
    </header>

    <!-- âœ… æ–°å¢ï¼šå¦‚æœæ²’å‚³å…¥è³‡æ–™æ™‚è·³å‡ºï¼Œè¼¸å…¥ç©å®¶åç¨±èˆ‡å¹´ç´šçš„å½ˆå‡ºè¦–çª— -->
    <div id="player-popup" class="player-popup">
        <div class="popup-content">
            <h2>æ­¡è¿ä¾†åˆ°é§•é§›è‰™ï¼ğŸš€</h2>
            <p>è«‹è¼¸å…¥ä½ çš„ç©å®¶åç¨±ï¼ˆä»£è™Ÿï¼‰èˆ‡å¹´ç´š</p>
            <input type="text" id="playerName" placeholder="è«‹è¼¸å…¥ç©å®¶åç¨±" required>
            <select id="playerGrade">
                <option value="">è«‹é¸æ“‡å¹´ç´š[å¯é¸]</option>
                <option>å°å­¸ä¸€å¹´ç´š</option>
                <option>å°å­¸äºŒå¹´ç´š</option>
                <option>å°å­¸ä¸‰å¹´ç´š</option>
                <option>å°å­¸å››å¹´ç´š</option>
                <option>å°å­¸äº”å¹´ç´š</option>
                <option>å°å­¸å…­å¹´ç´š</option>
                <option>åœ‹ä¸­ä¸€å¹´ç´š</option>
                <option>åœ‹ä¸­äºŒå¹´ç´š</option>
                <option>åœ‹ä¸­ä¸‰å¹´ç´š</option>
                <option>é«˜ä¸­ä¸€å¹´ç´š</option>
                <option>é«˜ä¸­äºŒå¹´ç´š</option>
                <option>é«˜ä¸­ä¸‰å¹´ç´š</option>
                <option>å¤§å­¸ä¸€å¹´ç´š</option>
                <option>å¤§å­¸äºŒå¹´ç´š</option>
                <option>å¤§å­¸ä¸‰å¹´ç´š</option>
                <option>å¤§å­¸å››å¹´ç´š</option>
                <option>å…¶ä»–å¹´é½¡å±¤</option>
            </select>
            <button id="startGame">é–‹å§‹æ¢ç´¢ âœ¨</button>
        </div>
    </div>
    
    <!-- ä¸»é é¢ -->
     
    <main style="margin-top: 80px;">
        <div class="chapter-img2-wrapper">
            <img class="chapter-img2" src="../0-IMAGE/4-Game-Chapter/ç« ç¯€æ——å¹Ÿ-æ¸¬é©—.png" alt="ç« ç¯€æ——å¹Ÿ">
            <span class="chapter-title2">ç¶²é å®‰å…¨æ¢ç´¢</span>
        </div>
        <div class="quiz-container"></div>

        <!-- Modal -->
        <div class="modal" id="result-modal">
            <div class="modal-content">
                <p id="modal-text"></p>
                <button id="retry-btn">ç¹¼çºŒä½œç­” </button>
            </div>
        </div>
    </main>



    <!-- é å°¾ -->
    <footer class="footer">
        <!-- å¯æ”¾æ–‡å­—æˆ–æŒ‰éˆ• -->
        <span >Â© 2025 ä¸­å­¸ç”Ÿè³‡è¨Šå®‰å…¨ç¶²</span>
    </footer>



<!---------------------------- JS ------------------------------>
    
    <script>
        //è¼‰å…¥å°è¦½åˆ—
        fetch('./0_Nav-2.html')
        .then(response => response.text())
        .then(data => {
            document.getElementById('header-container').innerHTML = data;
        })
        .catch(error => {
            console.error('è¼‰å…¥ HTML å¤±æ•—:', error);
        });

       //ç¶å®šURLåƒæ•¸
        const params = new URLSearchParams(window.location.search);
        const title = params.get('title');      // ex: "ç¬¬ä¸€ç« "
        const subtitle = params.get('subtitle'); // ex: "ç³»çµ±å®‰å…¨æ˜¯ä»€éº¼ï¼Ÿ"
        console.log(title, subtitle); // ç¢ºèªä½¿ç”¨çš„è³‡æ–™

        // æ›´æ–°ç« ç¯€æ¨™é¡Œ
        const t1 = document.querySelector('.chapter-title1');
        const t2 = document.querySelector('.chapter-title2');
        if (t1) t1.textContent = title || t1.textContent;
        if (t2) t2.textContent = subtitle || t2.textContent;

        // Excel ç›¸å°è·¯å¾‘
        const excelPath = "../4-Teaching/2-Ch_questions.xlsx";

        // è®€å– Excel
        fetch(excelPath).then(res=>res.arrayBuffer())
        .then(data=>{
            const wb = XLSX.read(data,{type:'array'});
            const sheet = wb.Sheets[wb.SheetNames[0]];
            const jsonData = XLSX.utils.sheet_to_json(sheet);

            // âœ… å¤šç« ç¯€æ”¯æ´
            const selectedChapters = title.split(',').map(t => t.trim());
            let chapterQs = jsonData.filter(row => selectedChapters.includes(row.Chapter));

            // âœ… é¡Œç›®æ‰“äº‚
            chapterQs = chapterQs.sort(() => Math.random() - 0.5);

            const quizContainer = document.querySelector('.quiz-container');
            quizContainer.innerHTML = '';

            // âœ… é¡¯ç¤ºé¡Œç›®
            chapterQs.forEach((q, idx)=>{
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question';
                questionDiv.setAttribute('data-answer', q.Answer); // æ­£ç¢ºç­”æ¡ˆæ¬„ä½

                let optionsHtml = '';
                ['OptionA','OptionB','OptionC','OptionD'].forEach(opt=>{
                    if(q[opt]){
                        optionsHtml += `<label><input type="radio" name="q${idx+1}" value="${opt.slice(-1).toLowerCase()}"> ${q[opt]}</label>`;
                    }
                });

                questionDiv.innerHTML = `
                    <h3>${idx+1}. ã€${q.Chapter}ã€‘ ${q.Question}</h3>
                    <div class="options">${optionsHtml}</div>
                `;
                quizContainer.appendChild(questionDiv);
            });

            // âœ… åˆå§‹åŒ–éŒ¯èª¤æ¬¡æ•¸
            const questionErrors = Array(chapterQs.length).fill(0);

            // âœ… åŠ å…¥æäº¤æŒ‰éˆ•
            quizContainer.insertAdjacentHTML('beforeend','<button id="submit-single" style="display:block; margin:20px auto;">æäº¤å–®é¸é¡Œ</button>');

            const submitSingleBtn = document.getElementById("submit-single");
            const modal = document.getElementById("result-modal");
            const modalText = document.getElementById("modal-text");

            submitSingleBtn.addEventListener("click", ()=> {
                const questions = document.querySelectorAll(".question[data-answer]");
                let correctCount = 0;

                questions.forEach((q, idx)=>{
                    const selected = q.querySelector('input[type="radio"]:checked');
                    const answer = q.getAttribute("data-answer").trim().toLowerCase();

                    let statusSpan = q.querySelector(".status-text");
                    if(!statusSpan){
                        statusSpan = document.createElement("span");
                        statusSpan.className = "status-text";
                        statusSpan.style.marginLeft = "24px";
                        statusSpan.style.fontSize = "16px";
                        q.querySelector("h3").appendChild(statusSpan);
                    }

                    if(selected && selected.value.toLowerCase() === answer){
                        correctCount++;
                        q.dataset.correct = "true";

                        statusSpan.textContent = "[æ­£ç¢º]";
                        statusSpan.style.color = "limegreen";

                        const radios = q.querySelectorAll('input[type="radio"]');
                        radios.forEach(radio=>{
                            if(radio.value.toLowerCase() !== answer) radio.disabled = true;
                            radio.addEventListener('click',(e)=>{
                                if(q.dataset.correct==="true"){
                                    e.preventDefault();
                                    radio.checked=true;
                                }
                            });
                        });

                        if (questionErrors[idx] > 0) {
                            statusSpan.innerHTML = `<span style="color:limegreen;">[æ­£ç¢º]</span> <span style="color:limegreen;">${questionErrors[idx]} æ¬¡éŒ¯èª¤</span>`;
                        } else {
                            statusSpan.textContent = "[æ­£ç¢º]";
                            statusSpan.style.color = "limegreen";
                        }

                    } else {
                        questionErrors[idx]++;
                        statusSpan.textContent = `[éŒ¯èª¤]${questionErrors[idx]} æ¬¡éŒ¯èª¤`;
                        statusSpan.style.color = "red";
                    }
                });

                modalText.innerHTML = `ä½ ç­”å°äº† ${correctCount} / ${questions.length} é¡Œ`;
                modal.style.display = "flex";

                // âœ… å…¨å°æ™‚é¡¯ç¤ºã€ŒæŸ¥çœ‹ç­”é¡Œç‹€æ…‹ã€
                if (correctCount === questions.length) {
                    submitSingleBtn.style.display = "none";
                    const retryBtn = document.getElementById("retry-btn");
                    retryBtn.textContent = "æŸ¥çœ‹ç­”é¡Œç‹€æ…‹";

                    retryBtn.onclick = () => {
                        retryBtn.remove();

                        // âœ… å»ºç«‹ç­”é¡Œç‹€æ…‹å®¹å™¨
                        const statusContainer = document.createElement("div");
                        statusContainer.style.display = "flex";
                        statusContainer.style.flexWrap = "wrap";  // è¶…å‡ºè‡ªå‹•æ›è¡Œ
                        statusContainer.style.maxHeight = "500px"; // æœ€å¤§é«˜åº¦
                        statusContainer.style.overflowY = "auto";  // è¶…éé«˜åº¦å¯æ»¾å‹•
                        statusContainer.style.gap = "15px";       // å„é¡Œé–“è·
                        statusContainer.style.padding = "10px";

                        // âœ… è¨ˆç®—ç¸½éŒ¯é¡Œæ•¸åŠå„ç« ç¯€éŒ¯é¡Œæ•¸
                        let totalErrors = 0;
                        const chapterErrors = {}; // { "ç¬¬ä¸€ç« ": 2, "ç¬¬äºŒç« ": 0, ... }

                        chapterQs.forEach((q, idx) => {
                            const statusBlock = document.createElement("div");
                            statusBlock.style.width = "200px";       
                            statusBlock.style.padding = "8px";
                            statusBlock.style.border = "1px solid rgba(255,255,255,0.3)";
                            statusBlock.style.borderRadius = "10px";
                            statusBlock.style.background = "rgba(0,0,0,0.3)";
                            
                            const errors = questionErrors[idx];
                            if (errors > 0) totalErrors++;

                            // ç´¯åŠ å„ç« ç¯€éŒ¯é¡Œæ•¸
                            if (!chapterErrors[q.Chapter]) chapterErrors[q.Chapter] = 0;
                            chapterErrors[q.Chapter] += errors > 0 ? 1 : 0;

                            const color = errors === 0 ? "green" : "red";
                            statusBlock.innerHTML = `ã€${q.Chapter}ã€‘Q${idx+1}: <span style="color:${color};">${errors} æ¬¡éŒ¯èª¤</span>`;
                            
                            statusContainer.appendChild(statusBlock);
                        });

                        // æ¸…ç©º modalText ä¸¦åŠ å…¥å®¹å™¨
                        modalText.innerHTML = "<h3>ç­”é¡Œç‹€æ…‹</h3>";
                        modalText.appendChild(statusContainer);

                        // ğŸ”¹å»ºç«‹æŒ‰éˆ•å®¹å™¨
                        const btnContainer = document.createElement("div");
                        btnContainer.style.marginTop = "20px";
                        btnContainer.style.display = "flex";
                        btnContainer.style.justifyContent = "center";
                        btnContainer.style.gap = "20px";

                        // è¿”å›æ¸¬é©—åˆ—è¡¨
                        const backToQuizList = document.createElement("button");
                        backToQuizList.textContent = "è¿”å›æ¸¬é©—åˆ—è¡¨";
                        backToQuizList.onclick = () => window.location.href = "6_ToTest.html";
                        btnContainer.appendChild(backToQuizList);

                        // âœ… å–®ç« ç¯€æ‰æä¾›è¿”å›ç« ç¯€
                        const selectedChapters = title.split(',').map(t => t.trim());
                        if (selectedChapters.length === 1) {
                            const backToChapter = document.createElement("button");
                            backToChapter.textContent = "è¿”å›ç« ç¯€";
                            backToChapter.onclick = () => window.history.back();
                            btnContainer.appendChild(backToChapter);
                        }

                        modalText.appendChild(btnContainer);

                        // âœ… åœ¨æœ€ä¸‹æ–¹é¡¯ç¤ºéŒ¯èª¤ç¸½é¡Œæ•¸ + å„ç« ç¯€éŒ¯é¡Œæ•¸
                        const totalErrorDiv = document.createElement("div");
                        totalErrorDiv.style.marginTop = "20px";
                        totalErrorDiv.style.textAlign = "center";
                        totalErrorDiv.style.fontSize = "16px";
                        totalErrorDiv.style.color = "orange";

                        // æ§‹é€ å„ç« ç¯€éŒ¯é¡Œæ•¸å­—ä¸²
                        const chapterErrorStr = selectedChapters.map(ch => `${ch}:${chapterErrors[ch] || 0}é¡Œ`).join('ï¼Œ');

                        totalErrorDiv.innerHTML = `å·²é¸ç« ç¯€éŒ¯èª¤ç¸½é¡Œæ•¸ï¼š${totalErrors} é¡Œï¼ˆ${chapterErrorStr}ï¼‰`;
                        modalText.appendChild(totalErrorDiv);

                        modal.style.display = "flex";
                    };
                }
            });

            document.getElementById("retry-btn").addEventListener("click", ()=>{
                modal.style.display = "none";
            });
        }).catch(err=>console.error("è®€å– Excel å¤±æ•—:",err));
        


    </script>

    <script>
        /* ======== ç©å®¶è³‡æ–™æª¢æŸ¥èˆ‡å°å‘ ======== */
        const params2 = new URLSearchParams(window.location.search);
        const playerName = params2.get('playerName');
        const playerGrade = params2.get('playerGrade');
        const popup = document.getElementById('player-popup');

        // âœ… å¦‚æœ URL æ²’æœ‰ playerName â†’ é¡¯ç¤ºè¼¸å…¥è¦–çª—
        if (!playerName) {
            popup.style.display = 'flex';
            popup.style.position = 'fixed';
            popup.style.top = '0';
            popup.style.left = '0';
            popup.style.width = '100%';
            popup.style.height = '100%';
            popup.style.background = 'rgba(0,0,0,0.7)';
            popup.style.justifyContent = 'center';
            popup.style.alignItems = 'center';
        }

        // âœ… é»æ“Šã€Œé–‹å§‹æ¢ç´¢ã€å¾Œï¼ŒæŠŠç©å®¶è³‡æ–™åŠ åˆ° URL
        document.getElementById('startGame').addEventListener('click', () => {
            const nameInput = document.getElementById('playerName').value.trim();
            const gradeInput = document.getElementById('playerGrade').value;

            if (!nameInput) {
                alert("è«‹è¼¸å…¥ç©å®¶åç¨±ï¼");
                return;
            }

            // å–åŸæœ¬ URL çš„ç« ç¯€è³‡æ–™
            const title = params2.get('title') || '';
            const subtitle = params2.get('subtitle') || '';

            // é‡æ–°å°å‘ï¼ˆé™„ä¸Šç©å®¶è³‡æ–™ï¼‰
            const newURL = `${window.location.pathname}?title=${encodeURIComponent(title)}&subtitle=${encodeURIComponent(subtitle)}&playerName=${encodeURIComponent(nameInput)}&playerGrade=${encodeURIComponent(gradeInput)}`;
            window.location.href = newURL;
        });

                // â–¶è¿”å›æŒ‰éˆ•ï¼š ï¼ˆä¿ç•™åŸå…ˆåƒæ•¸ï¼‰
        function enterBack() {
            const encodedTitle = encodeURIComponent(title || '');
            const encodedSubtitle = encodeURIComponent(subtitle || '');
            window.location.href = `4-Game-Chapter.html?title=${encodedTitle}&subtitle=${encodedSubtitle}&`;
        }
    </script>
</body>
</html>